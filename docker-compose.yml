# version: '3.8'

# services:
#   backend:
#     build: ./server
#     env_file:
#       - ./server/.env

#     restart: unless-stopped

#   frontend:
#     build:
#       context: ./client
#       args:
#         VITE_API_URL: /api
#     ports:
#       - '80:80'
#     depends_on:
#       - backend
#     restart: unless-stopped

services:
  backend:
    build: ./server
    env_file:
      - ./server/.env
    healthcheck:
      test: ['CMD', 'wget', '--spider', '-q', 'http://localhost:3000/health']
      interval: 30s
      timeout: 5s
      retries: 3
    restart: unless-stopped

  frontend:
    build:
      context: ./client
      args:
        VITE_API_URL: /api
    ports:
      - '80:80'
    depends_on:
      - backend
    restart: unless-stopped
